---
lab:
  title: تطوير تطبيق دردشة يدعم الصوت
  description: تعرّف على كيفية استخدام Azure AI Foundry لبناء تطبيق ذكاء اصطناعي توليدي يدعم إدخال الصوت.
---

# تطوير تطبيق دردشة يدعم الصوت

في هذا التمرين، يمكنك استخدام نموذج الذكاء الاصطناعي التوليدي *Phi-4-multimodal-instruct* لتوليد ردود للمطالبات التي تتضمن ملفات صوتية. ستقوم بتطوير تطبيق يوفر المساعدة الذكية لشركة توريد منتجات باستخدام Azure AI Foundry وPython OpenAI SDK لتلخيص الرسائل الصوتية التي يتركها العملاء.

على الرغم من أن هذا التمرين يستند إلى Python، يمكنك تطوير تطبيقات مماثلة باستخدام حزم SDK مخصصة للغات برمجة متعددة، منها:

- [مشاريع الذكاء الاصطناعي في Azure للغة Python](https://pypi.org/project/azure-ai-projects)
- [مكتبة OpenAI للغة Python](https://pypi.org/project/openai/)
- [مشاريع الذكاء الاصطناعي في Azure للغة Microsoft .NET](https://www.nuget.org/packages/Azure.AI.Projects)
- [مكتبة عميل Azure OpenAI الخاصة بـ Microsoft .NET](https://www.nuget.org/packages/Azure.AI.OpenAI)
- [مشاريع الذكاء الاصطناعي في Azure للغة JavaScript](https://www.npmjs.com/package/@azure/ai-projects)
- [مكتبة Azure OpenAI للغة TypeScript](https://www.npmjs.com/package/@azure/openai)

سيستغرق هذا التدريب حوالي **30** دقيقة.

## إنشاء مشروع في مصنع الذكاء الاصطناعي في Azure

لنبدأ بتوزيع نموذج في مشروع Azure AI Foundry.

1. في متصفح الويب، افتح [مدخل Azure AI Foundry](https://ai.azure.com) على `https://ai.azure.com` وسجّل الدخول باستخدام بيانات اعتماد Azure الخاصة بك. أغلق أية تلميحات أو أجزاء تشغيل سريع يتم فتحها عندما تقوم بتسجيل الدخول، وإذا لزم الأمر، استخدم شعار **مصنع الذكاء الاصطناعي في Azure** في أعلى اليسار للانتقال إلى الصفحة الرئيسية، والتي تبدو مشابهة للصورة التالية:

    ![لقطة شاشة لمدخل Azure AI Foundry.](../media/ai-foundry-home.png)

1. في الصفحة الرئيسية، في قسم **استكشاف النماذج والإمكانات**، ابحث عن النموذج `Phi-4-multimodal-instruct`؛ الذي سنستخدمه في مشروعنا.
1. في نتائج البحث، حدّد نموذج **Phi-4-multimodal-instruct** لعرض تفاصيله، ثم في أعلى صفحة النموذج، حدّد **استخدام هذا النموذج**.
1. عند مطالبتك بإنشاء مشروع، أدخل اسمًا صالحًا لمشروعك ووسّع **الخيارات المتقدمة**.
1. حدد **تخصيص** وحدد الإعدادات التالية لمركزك:
    - **مورد Azure AI Foundry**: *اسم صالح لمورد Azure AI Foundry الخاص بك*
    - **Subscription**: *اشتراكك في Azure*
    - **Resource group**: *إنشاء مجموعة موارد أو تحديدها*
    - **المنطقة**: *حدد أيًّا من **ميزات AI Foundry الموصى بها***\*

    > \*تخضع بعض موارد الذكاء الاصطناعي في Azure لحصص النموذج الإقليمية. في حالة تجاوز مساحة القرص المتوفرة لاحقًا في التدريب، هناك احتمال أن تحتاج إلى إنشاء مورد آخر في منطقة مختلفة. يمكنك التحقق من أحدث توفر إقليمي للنماذج المحددة في [وثائق Azure AI Foundry](https://learn.microsoft.com/azure/ai-foundry/how-to/deploy-models-serverless-availability#region-availability)

1. حدد **إنشاء** وانتظر حتى يتم إنشاء مشروعك.

    قد تستغرق العملية بضع لحظات لإتمامها.

1. حدّد **الموافقة والمتابعة** للموافقة على شروط النموذج، ثم حدّد **توزيع** لإتمام توزيع نموذج Phi.

1. عند إنشاء مشروعك، ستُفتح تفاصيل النموذج تلقائيًا. لاحظ اسم توزيع النموذج الخاص بك؛ والذي يجب أن يكون **Phi-4-multimodal-instruct**

1. في جزء التنقل على اليسار، حدد **نظرة عامة** لرؤية الصفحة الرئيسية لمشروعك؛ والتي تبدو كما يلي:

    > **ملاحظة**: إذا تم عرض الخطأ *الأذونات غير كافية**، فاستخدم زر **إصلاح المشكلة** لحلها.

    ![لقطة شاشة لصفحة نظرة عامة على مشروع Azure AI Foundry.](../media/ai-foundry-project.png)

## أنشئ تطبيق عميل

الآن بعد أن قمت بتوزيع نموذج، يمكنك استخدام عِدد تطوير البرامج (SDK) الخاصة بـ Azure AI Foundry وAzure AI Model Inference لتطوير تطبيق يتواصل معه من خلال المحادثة.

> **تلميح**: يمكنك اختيار تطوير الحل الخاص بك باستخدام Python أو Microsoft C#. اتبع الإرشادات في القسم المناسب للغة التي اخترتها.

### إعداد تكوين التطبيق

1. في مدخل مصنع الذكاء الاصطناعي في Azure، اعرض صفحة **النظرة العامة** لمشروعك.
1. في منطقة **تفاصيل المشروع**، دوّن **نقطة نهاية مشروع Azure AI Foundry**. ستستخدم نقطة النهاية هذه للاتصال بمشروعك في تطبيق العميل.
1. افتح علامة تبويب جديدة للمتصفح (مع إبقاء مدخل مصنع الذكاء الاصطناعي في Azure مفتوحًا في علامة التبويب الموجودة). بعد ذلك في علامة التبويب الجديدة، انتقل إلى [بوابة Azure](https://portal.azure.com) على `https://portal.azure.com`؛ وسجّل الدخول باستخدام بيانات اعتماد Azure الخاصة بك إذا طُلب منك ذلك.

    أغلق أي إشعارات ترحيبية لرؤية الصفحة الرئيسية لبوابة Azure.

1. استخدم الزر **[\>_]** الموجود على يمين شريط البحث أعلى الصفحة لإنشاء Cloud Shell جديد في بوابة Azure، وتحديد بيئة ***PowerShell*** بدون مساحة تخزين في اشتراكك.

    يوفّر Cloud Shell واجهة سطر الأوامر في الجزء الموجود في أسفل بوابة Azure. يمكنك تغيير حجم هذا الجزء أو تكبيره لتسهيل العمل فيه.

    > **ملاحظة**: إذا كنت قد أنشأت مسبقًا Cloud Shell يستخدم بيئة *معالج Bash*، فبدّل إلى ***PowerShell***.

1. في شريط أدوات Cloud Shell، في قائمة **الإعدادات**، حدد **الانتقال إلى الإصدار الكلاسيكي** (هذا مطلوب لاستخدام محرر التعليمات البرمجية).

    **<font color="red">تأكد من التبديل إلى الإصدار الكلاسيكي من cloud shell قبل المتابعة.</font>**

1. في جزء Cloud Shell، أدخل الأوامر التالية لنسخ مخزن بيانات GitHub الخاص الذي يحتوي على ملفات التعليمات البرمجية لهذا التدريب (اكتب الأمر أو انسخه إلى الحافظة ثم انقر بزر الماوس الأيمن في سطر الأوامر والصقه كنص عادي):

    ```
   rm -r mslearn-ai-audio -f
   git clone https://github.com/MicrosoftLearning/mslearn-ai-language
    ```

    > **تلميح**: عند لصق الأوامر في CloudShell، قد يشغل الإخراج مساحة كبيرة من ذاكرة التخزين المؤقت للشاشة. يمكنك مسح الشاشة عن طريق إدخال الأمر `cls` لتسهيل التركيز على كل مهمة.

1. بعد استنساخ مخزن بيانات خاصة، انتقل إلى المجلد الذي يحتوي على ملفات التعليمات البرمجية لتطبيق الدردشة:  

    ```
   cd mslearn-ai-language/Labfiles/09-audio-chat/Python
    ````

1. في جزء سطر أوامر Cloud Shell، أدخل الأمر التالي لتثبيت المكتبات التي ستستخدمها:

    ```
   python -m venv labenv
   ./labenv/bin/Activate.ps1
   pip install -r requirements.txt azure-identity azure-ai-projects openai
    ```

1. أدخل الأمر التالي لتحرير ملف التكوين الذي تم توفيره:

    ```
   code .env
    ```

    ينبغي أن يفتح الملف في محرر التعليمات البرمجية.

1. في ملف التعليمات البرمجية، استبدل عنصر نائب **your_project_endpoint** برابط نقطة النهاية الخاص بمشروعك (المنسوخ من صفحة **نظرة عامة** في مدخل Azure AI Foundry)، واستبدل عنصر نائب **your_model_deployment** بالاسم الذي خصصته لتوزيع نموذج Phi-4-multimodal-instruct.

1. بعد استبدال العناصر النائبة، في محرر التعليمات البرمجية، استخدم الأمر **CTRL+S** أو **انقر بزر الماوس الأيمن > حفظ** لحفظ التغييرات، ثم استخدم الأمر **CTRL+Q** أو **انقر بزر الماوس الأيمن > إنهاء** لإغلاق محرر التعليمات البرمجية مع إبقاء سطر أوامر Cloud Shell مفتوحًا.

### اكتب التعليمة البرمجية للاتصال بمشروعك والحصول على عميل دردشة لنموذجك

> **تلميح**: عند إضافة التعليمات البرمجية، تأكد من الحفاظ على المسافة البادئة الصحيحة.

1. أدخِل الأمر التالي لتحرير ملف التعليمات البرمجية:

    ```
   code audio-chat.py
    ```

1. في ملف التعليمات البرمجية، لاحظ العبارات الموجودة في أعلى الملف والتي تمت إضافتها لاستيراد مساحات الأسماء (Namespaces) الضرورية لـ (SDK). بعد ذلك، ابحث عن التعليق **إضافة المراجع**، وأضف التعليمة البرمجية التالية للإشارة إلى المساحات الأساسية في المكتبات التي قمت بتثبيتها مسبقًا:

    ```python
   # Add references
   from azure.identity import DefaultAzureCredential
   from azure.ai.projects import AIProjectClient
    ```

1. في الوظيفة **الرئيسية**، تحت التعليق **الحصول على إعدادات التكوين**، لاحظ أن التعليمة البرمجية تقوم بتحميل قيم سلسلة الاتصال بالمشروع واسم نشر النموذج التي قمت بتحديدها في ملف التكوين.

1. ابحث عن التعليق **Initialize the project client** وأضِف التعليمات البرمجية التالية لربط مشروعك في Azure AI Foundry:

    > **تلميح**: كن حذرًا للحفاظ على مستوى المسافة البادئة الصحيح للتعليمات البرمجية الخاصة بك.

    ```python
   # Initialize the project client
   project_client = AIProjectClient(            
       credential=DefaultAzureCredential(
           exclude_environment_credential=True,
           exclude_managed_identity_credential=True
       ),
       endpoint=project_endpoint,
   )
    ```

1. ابحث عن التعليق **الحصول على عميل دردشة**، وأضف التعليمة البرمجية التالية لإنشاء عنصر عميل للدردشة مع النموذج الخاص بك:

    ```python
   # Get a chat client
   openai_client = project_client.get_openai_client(api_version="2024-10-21")
    ```

### اكتب التعليمات البرمجية لإرسال مطالبة قائمة على الصوت

قبل إرسال المطالبة، نحتاج إلى ترميز ملف الصوت للطلب. ثم يمكننا إرفاق بيانات الصوت مع رسالة المستخدم كمطالبة لنموذج اللغة الكبيرة (LLM). لاحظ أن التعليمات البرمجية تحتوي على حلقة تسمح للمستخدم بإدخال مطالبة حتى يكتب "quit". 

1. ضمن التعليق **Encode the audio file**، أدخِل التعليمات البرمجية التالية لإعداد ملف الصوت المحدد:

    <video controls src="https://github.com/MicrosoftLearning/mslearn-ai-language/raw/refs/heads/main/Instructions/media/avocados.mp4" title="طلب الأفوكادو" width="150"></video>

    ```python
   # Encode the audio file
   file_path = "https://github.com/MicrosoftLearning/mslearn-ai-language/raw/refs/heads/main/Labfiles/09-audio-chat/data/avocados.mp3"
   response = requests.get(file_path)
   response.raise_for_status()
   audio_data = base64.b64encode(response.content).decode('utf-8')
    ```

1. ضمن التعليق **Get a response to audio input**، أضِف التعليمات البرمجية التالية لإرسال المطالبة:

    ```python
   # Get a response to audio input
   response = openai_client.chat.completions.create(
       model=model_deployment,
       messages=[
           {"role": "system", "content": system_message},
           { "role": "user",
               "content": [
               { 
                   "type": "text",
                   "text": prompt
               },
               {
                   "type": "input_audio",
                   "input_audio": {
                       "data": audio_data,
                       "format": "mp3"
                   }
               }
           ] }
       ]
   )
   print(response.choices[0].message.content)
    ```

1. استخدم الأمر **CTRL+S** لحفظ التغييرات في ملف التعليمات البرمجية. يمكنك أيضًا إغلاق محرر التعليمات البرمجية باستخدام (**CTRL+Q**) إذا رغبت في ذلك.

### سجّل الدخول إلى Azure وشغّل التطبيق

1. في جزء سطر أوامر Cloud Shell، أدخل الأمر التالي لتسجيل الدخول إلى Azure.

    ```
   az login
    ```

    **<font color="red">يجب عليك تسجيل الدخول إلى Azure - حتى لو تم بالفعل مصادقة جلسة Cloud Shell.</font>**

    > **ملاحظة**: في معظم السيناريوهات، سيكون استخدام *az login* كافيًا. ومع ذلك، إذا كان لديك اشتراكات لدى مستأجرين متعددين، فقد تحتاج إلى تحديد المستأجر باستخدام المعلمة *--tenant*. راجع [تسجيل الدخول إلى Azure بشكل تفاعلي باستخدام Azure CLI](https://learn.microsoft.com/cli/azure/authenticate-azure-cli-interactively) للحصول على التفاصيل.
    
1. عند مطالبتك بذلك، اتبع الإرشادات لفتح صفحة تسجيل الدخول في علامة تبويب جديدة وأدخل رمز المصادقة المقدم وبيانات اعتماد Azure الخاصة بك. ثم أكمل عملية تسجيل الدخول في سطر الأوامر، وحدد الاشتراك الذي يحتوي على مركز Azure AI Foundry الخاص بك إذا طُلب منك ذلك.

1. في جزء سطر أوامر Cloud Shell، أدخل الأمر التالي لتشغيل التطبيق:

    ```
   python audio-chat.py
    ```

1. عند طلب ذلك، أدخل المطالبة 

    ```
   Can you summarize this customer's voice message?
    ```

1. راجع الاستجابة.

### استخدم ملفًا صوتيًا مختلفًا

1. في محرر التعليمات البرمجية الخاص بتطبيقك، ابحث عن التعليمات البرمجية التي أضفتها سابقًا ضمن التعليق **Encode the audio file**. ثم عدِّل مسار ملف الصوت كما يلي لاستخدام ملف صوتي مختلف للطلب (مع الاحتفاظ بالتعليمات البرمجية الحالية بعد مسار الملف):

    ```python
   # Encode the audio file
   file_path = "https://github.com/MicrosoftLearning/mslearn-ai-language/raw/refs/heads/main/Labfiles/09-audio-chat/data/fresas.mp3"
    ```

    يبدو الملف الجديد كما يلي:

    <video controls src="https://github.com/MicrosoftLearning/mslearn-ai-language/raw/refs/heads/main/Instructions/media/fresas.mp4" title="طلب فراولة" width="150"></video>

 1. استخدم الأمر **CTRL+S** لحفظ التغييرات في ملف التعليمات البرمجية. يمكنك أيضًا إغلاق محرر التعليمات البرمجية باستخدام (**CTRL+Q**) إذا رغبت في ذلك.

1. في جزء سطر أوامر Cloud Shell أسفل محرر التعليمات البرمجية، أدخل الأمر التالي لتشغيل التطبيق:

    ```
   python audio-chat.py
    ```

1. عند طلب بذلك، أدخل المطالبة التالية: 
    
    ```
   Can you summarize this customer's voice message? Is it time-sensitive?
    ```

1. راجع الاستجابة. ثم أدخل `quit` للخروج من البرنامج.

    > **ملاحظة**: في هذا التطبيق البسيط، لم ننفّذ منطق للاحتفاظ بسجل المحادثة؛ لذلك سيعامل النموذج كل مطالبة على أنها طلب جديد دون أي سياق للمطالبة السابقة.

1. يمكنك الاستمرار في تشغيل التطبيق، واختيار أنواع مختلفة من المطالبات وتجربة مطالبات متنوعة. عند الانتهاء، أدخل `quit` للخروج من البرنامج.

    إذا كان لديك الوقت، فيمكنك تعديل التعليمة البرمجية لاستخدام مطالبة نظام مختلفة وملفات صوتية خاصة بك يمكن الوصول إليها عبر الإنترنت.

    > **ملاحظة**: في هذا التطبيق البسيط، لم ننفّذ منطق للاحتفاظ بسجل المحادثة؛ لذلك سيعامل النموذج كل مطالبة على أنها طلب جديد دون أي سياق للمطالبة السابقة.

## الملخص

في هذا التمرين، استخدمت Azure AI Foundry وAzure AI Inference SDK لإنشاء تطبيق عميل يستخدم نموذجًا متعدد الوسائط لتوليد الردود للصوت.

## تنظيف

إذا كنت قد أنهيت استكشاف Azure AI Foundry، يجب عليك حذف الموارد التي أنشأتها في هذا التمرين لتجنب تكاليف Azure غير الضرورية.

1. ارجع إلى علامة تبويب المتصفح التي تحتوي على بوابة Azure (أو أعد فتح [بوابة Azure](https://portal.azure.com) في `https://portal.azure.com` في علامة تبويب متصفح جديدة) واعرض محتويات مجموعة الموارد التي نشرت فيها الموارد المستخدمة في هذا التدريب.
1. على شريط الأدوات، حدد **حذف مجموعة الموارد**.
1. أدخل اسم مجموعة الموارد وأكّد أنك تريد حذفها.
